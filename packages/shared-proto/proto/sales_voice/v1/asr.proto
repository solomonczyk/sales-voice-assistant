syntax = "proto3";

package sales_voice.v1;

import "google/protobuf/timestamp.proto";

// Сервис распознавания речи
service ASRService {
  // Распознать речь из аудио
  rpc RecognizeSpeech(RecognizeSpeechRequest) returns (RecognizeSpeechResponse);
  
  // Потоковое распознавание речи
  rpc StreamRecognizeSpeech(stream StreamRecognizeSpeechRequest) returns (stream StreamRecognizeSpeechResponse);
  
  // Получить статус распознавания
  rpc GetRecognitionStatus(GetRecognitionStatusRequest) returns (GetRecognitionStatusResponse);
  
  // Отменить распознавание
  rpc CancelRecognition(CancelRecognitionRequest) returns (CancelRecognitionResponse);
}

// Формат аудио
enum AudioFormat {
  AUDIO_FORMAT_UNSPECIFIED = 0;
  AUDIO_FORMAT_WAV = 1;
  AUDIO_FORMAT_MP3 = 2;
  AUDIO_FORMAT_OGG = 3;
  AUDIO_FORMAT_FLAC = 4;
  AUDIO_FORMAT_RAW = 5;
}

// Статус распознавания
enum RecognitionStatus {
  RECOGNITION_STATUS_UNSPECIFIED = 0;
  RECOGNITION_STATUS_PENDING = 1;
  RECOGNITION_STATUS_PROCESSING = 2;
  RECOGNITION_STATUS_COMPLETED = 3;
  RECOGNITION_STATUS_FAILED = 4;
  RECOGNITION_STATUS_CANCELLED = 5;
}

// Результат распознавания
message RecognitionResult {
  string text = 1;
  double confidence = 2;
  google.protobuf.Timestamp timestamp = 3;
  repeated WordInfo words = 4;
}

// Информация о слове
message WordInfo {
  string word = 1;
  double confidence = 2;
  double start_time = 3;
  double end_time = 4;
}

// Запрос на распознавание речи
message RecognizeSpeechRequest {
  bytes audio_data = 1;
  AudioFormat format = 2;
  string language = 3;
  string session_id = 4;
  bool enable_word_timestamps = 5;
  bool enable_partial_results = 6;
}

// Ответ на распознавание речи
message RecognizeSpeechResponse {
  string recognition_id = 1;
  RecognitionStatus status = 2;
  RecognitionResult result = 3;
  string error_message = 4;
}

// Запрос на потоковое распознавание
message StreamRecognizeSpeechRequest {
  oneof streaming_request {
    RecognitionConfig config = 1;
    bytes audio_data = 2;
  }
}

// Конфигурация распознавания
message RecognitionConfig {
  AudioFormat format = 1;
  string language = 2;
  string session_id = 3;
  bool enable_word_timestamps = 4;
  bool enable_partial_results = 5;
  int32 sample_rate = 6;
  int32 channels = 7;
}

// Ответ на потоковое распознавание
message StreamRecognizeSpeechResponse {
  string recognition_id = 1;
  RecognitionStatus status = 2;
  RecognitionResult result = 3;
  bool is_partial = 4;
  string error_message = 5;
}

// Запрос на получение статуса распознавания
message GetRecognitionStatusRequest {
  string recognition_id = 1;
}

// Ответ на получение статуса распознавания
message GetRecognitionStatusResponse {
  string recognition_id = 1;
  RecognitionStatus status = 2;
  RecognitionResult result = 3;
  string error_message = 4;
  google.protobuf.Timestamp created_at = 5;
  google.protobuf.Timestamp updated_at = 6;
}

// Запрос на отмену распознавания
message CancelRecognitionRequest {
  string recognition_id = 1;
}

// Ответ на отмену распознавания
message CancelRecognitionResponse {
  string recognition_id = 1;
  bool cancelled = 2;
}
